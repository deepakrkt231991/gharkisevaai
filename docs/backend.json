{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the GrihSevaAI app.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "phoneNumber": {
          "type": "string",
          "description": "User's phone number.",
          "format": "string"
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "address": {
          "type": "string",
          "description": "User's address."
        },
        "languagePreference": {
          "type": "string",
          "description": "User's preferred language for communication."
        }
      },
      "required": [
        "id"
      ]
    },
    "Worker": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Worker",
      "type": "object",
      "description": "Represents a worker in the GrihSevaAI app.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the worker."
        },
        "name": {
          "type": "string",
          "description": "Worker's full name."
        },
        "skills": {
          "type": "array",
          "description": "List of skills possessed by the worker.",
          "items": {
            "type": "string"
          }
        },
        "location": {
          "type": "string",
          "description": "Worker's current location."
        },
        "availability": {
          "type": "array",
          "description": "Worker's availability schedule.",
          "items": {
            "type": "string"
          }
        },
        "hourlyRate": {
          "type": "number",
          "description": "Worker's hourly rate."
        },
        "languagePreference": {
          "type": "string",
          "description": "Worker's preferred language for communication."
        }
      },
      "required": [
        "id"
      ]
    },
    "Booking": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Booking",
      "type": "object",
      "description": "Represents a booking in the GrihSevaAI app.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the booking."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Booking)"
        },
        "workerId": {
          "type": "string",
          "description": "Reference to Worker. (Relationship: Worker 1:N Booking)"
        },
        "bookingDate": {
          "type": "string",
          "description": "Date of the booking.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "Description of the repair needed."
        },
        "imageUrls": {
          "type": "array",
          "description": "URLs of images uploaded by the user.",
          "items": {
            "type": "string"
          }
        },
        "status": {
          "type": "string",
          "description": "Status of the booking (e.g., pending, accepted, completed, cancelled)."
        },
        "estimatedCost": {
          "type": "number",
          "description": "Estimated cost of the repair."
        }
      },
      "required": [
        "id"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Each user document is uniquely identified by their userId.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/workers/{workerId}",
        "definition": {
          "entityName": "Worker",
          "schema": {
            "$ref": "#/backend/entities/Worker"
          },
          "description": "Stores worker profiles. Each worker document is uniquely identified by their workerId.",
          "params": [
            {
              "name": "workerId",
              "description": "Unique identifier for the worker."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/bookings/{bookingId}",
        "definition": {
          "entityName": "Booking",
          "schema": {
            "$ref": "#/backend/entities/Booking"
          },
          "description": "Stores booking information for each user. Includes denormalized 'userId' and 'workerId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "bookingId",
              "description": "Unique identifier for the booking."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure authorization independence, scalability, and ease of debugging, adhering to the principles outlined. It leverages denormalization to avoid hierarchical authorization dependencies and structural segregation for homogeneous security postures. The design incorporates explicit state modeling and predictable schemas to ensure data clarity and consistency.\n\nAuthorization Independence:\nUser data is stored under `/users/{userId}`. Bookings are stored under `/users/{userId}/bookings/{bookingId}` with the `userId` and `workerId` denormalized into each booking document. This allows security rules to validate access based on the current user's ID without needing to perform `get()` operations to verify ownership or permissions from parent documents.\n\nQAPs (Rules are not Filters):\nThe structure supports secure `list` operations. Listing bookings under `/users/{userId}/bookings` only requires checking that `request.auth.uid == userId`. The worker information is also denormalized in the booking to support secure listing on the worker side.\n\nInvariants:\nThe structure ensures the integrity of ownership with the explicit `userId` and `workerId` fields within the booking documents. Timestamps are implicitly supported via Firestore's serverTimestamp() feature, and denormalized data (like the `userId` and `workerId` in bookings) is explicitly managed to maintain consistency.\n\nAuto-Cancel:\nTo implement auto-cancel functionality, the `bookings` documents include a `status` field which is used to track the state of the booking (e.g., `pending`, `accepted`, `cancelled`). A Cloud Function can be scheduled to run periodically and check for bookings with a `pending` status that have exceeded the 5-minute acceptance window, and then automatically cancel them.\n\nAI Translation:\nThe `users` and `workers` documents each include a `languagePreference` field which is used to store the preferred language of the user or worker. This field can be used to determine which language to translate the chat messages to using the Gemini API."
  }
}